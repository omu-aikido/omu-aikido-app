---
import { default as Layout } from "@/src/layouts/layout.astro"
import { Role } from "@/src/class"
import Grid from "@/rr7/components/ui/Grid"
import { AppIcon } from "@/rr7/components/ui/AppIcon"
import { APPS } from "@/src/const"
import { AddRecord } from "@/rr7/components/component/AddRecord"
import { Recents } from "@/rr7/components/component/Recents"
import { style } from "@/src/styles/component"
const userId = Astro.locals.auth().userId
const profile = Astro.locals.profile
if (!profile || !userId) {
  return Astro.redirect("/sign-in")
}
const role = Role.fromString(profile.role)

if (role && role.isManagement() && !APPS.some((app) => app.name === "管理者メニュー")) {
  APPS.push({
    name: "管理者メニュー",
    path: "/admin",
    desc: "管理者メニューに移動します。",
  })
}
---

<Layout title="ダッシュボード">
  <h2 class={style.text.title()}>記録追加</h2>

  <AddRecord client:load />

  <Recents userId={userId} />

  <hr />
  <Grid variant="offset">
    {APPS.map((app) => <AppIcon title={app.name} id={app.path} desc={app.desc} />)}
  </Grid>
</Layout>
